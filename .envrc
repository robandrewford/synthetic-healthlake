# Health Platform - direnv configuration
# This file automatically loads environment variables when entering the directory
#
# Setup (one-time):
#   brew install direnv
#   echo 'eval "$(direnv hook zsh)"' >> ~/.zshrc
#   direnv allow .
#
# See: docs/development/env-variable-naming-convention.md

# Load .env file and export all variables
dotenv_if_exists .env

# Validate required Snowflake variables
required_vars=(
  "HP_SNF_ACCT"
  "HP_SNF_USER"
  "HP_SNF_PASS"
)

missing_vars=()
for var in "${required_vars[@]}"; do
  if [[ -z "${!var:-}" ]]; then
    missing_vars+=("$var")
  fi
done

if [[ ${#missing_vars[@]} -gt 0 ]]; then
  log_error "Missing required environment variables: ${missing_vars[*]}"
  log_error "Copy .env.example to .env and fill in your credentials"
fi

# AWS configuration (optional - uses default profile if not set)
export AWS_PROFILE="${HP_AWS_PROFILE:-default}"
export AWS_DEFAULT_REGION="${HP_AWS_REGION:-us-east-1}"

# dbt configuration
export DBT_PROFILES_DIR="${PWD}/dbt/snowflake"

# Python/UV configuration
export UV_PROJECT_DIR="${PWD}"

# Convenience aliases for tool compatibility
# These map our naming convention to what tools expect natively

# Snowflake CLI (snowsql) compatibility
export SNOWSQL_ACCOUNT="${HP_SNF_ACCT:-}"
export SNOWSQL_USER="${HP_SNF_USER:-}"
export SNOWSQL_PWD="${HP_SNF_PASS:-}"
export SNOWSQL_WAREHOUSE="${HP_SNF_WH:-COMPUTE_WH}"
export SNOWSQL_DATABASE="${HP_SNF_DB:-HEALTH_PLATFORM_DB}"
export SNOWSQL_SCHEMA="${HP_SNF_SCHEMA:-RAW}"
export SNOWSQL_ROLE="${HP_SNF_ROLE:-ACCOUNTADMIN}"

log_status "Health Platform environment loaded"
log_status "  Snowflake: ${HP_SNF_ACCT:-not set}"
log_status "  AWS Profile: ${AWS_PROFILE}"
log_status "  dbt profiles: ${DBT_PROFILES_DIR}"
